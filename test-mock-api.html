<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Mock API - Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            border-color: #28a745;
            background: #d4edda;
        }
        .error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status.online {
            background: #28a745;
            color: white;
        }
        .status.offline {
            background: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div style="text-align: center; margin-bottom: 30px;">
            <h1>ğŸ§ª ØªØ³Øª Mock API</h1>
            <div id="apiStatus" class="status">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ” ØªØ³Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</h3>
            <button class="test-button" onclick="testLogin()">ÙˆØ±ÙˆØ¯ Ø¨Ø§ Admin</button>
            <button class="test-button" onclick="testLoginWrong()">ÙˆØ±ÙˆØ¯ Ø§Ø´ØªØ¨Ø§Ù‡</button>
            <div id="loginResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ‘¥ ØªØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
            <button class="test-button" onclick="testGetUsers()">Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</button>
            <button class="test-button" onclick="testGetUsersByDept()">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù†</button>
            <div id="usersResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¢ ØªØ³Øª Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù†â€ŒÙ‡Ø§</h3>
            <button class="test-button" onclick="testGetDepartments()">Ø¯Ø±ÛŒØ§ÙØª Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù†â€ŒÙ‡Ø§</button>
            <div id="departmentsResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ ØªØ³Øª Ú©Ø§Ø±Ù‡Ø§</h3>
            <button class="test-button" onclick="testGetTasks()">Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ù‡Ø§</button>
            <button class="test-button" onclick="testCreateTask()">Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø± Ø¬Ø¯ÛŒØ¯</button>
            <div id="tasksResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š ØªØ³Øª Ú¯Ø²Ø§Ø±Ø´Ø§Øª</h3>
            <button class="test-button" onclick="testGetDashboard()">Ø¢Ù…Ø§Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
            <div id="dashboardResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ—„ï¸ ØªØ³Øª LocalStorage</h3>
            <button class="test-button" onclick="showLocalStorage()">Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
            <button class="test-button" onclick="clearLocalStorage()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
            <div id="storageResult" class="result"></div>
        </div>
    </div>

    <script src="api-mock.js"></script>
    <script>
        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª API
        function checkApiStatus() {
            const statusEl = document.getElementById('apiStatus');
            if (typeof mockDB !== 'undefined') {
                statusEl.textContent = 'ğŸŸ¢ Mock API ÙØ¹Ø§Ù„';
                statusEl.classList.add('online');
            } else {
                statusEl.textContent = 'ğŸ”´ Mock API ØºÛŒØ±ÙØ¹Ø§Ù„';
                statusEl.classList.add('offline');
            }
        }

        // Helper function Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = `result ${isError ? 'error' : 'success'}`;
        }

        // ØªØ³Øª ÙˆØ±ÙˆØ¯
        async function testLogin() {
            try {
                const result = await authAPI.login({ 
                    username: 'admin', 
                    password: 'admin123' 
                });
                showResult('loginResult', result);
            } catch (error) {
                showResult('loginResult', { error: error.message }, true);
            }
        }

        async function testLoginWrong() {
            try {
                const result = await authAPI.login({ 
                    username: 'wrong', 
                    password: 'wrong' 
                });
                showResult('loginResult', result);
            } catch (error) {
                showResult('loginResult', { error: error.message }, true);
            }
        }

        // ØªØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
        async function testGetUsers() {
            try {
                const result = await usersAPI.getAll();
                showResult('usersResult', result);
            } catch (error) {
                showResult('usersResult', { error: error.message }, true);
            }
        }

        async function testGetUsersByDept() {
            try {
                const result = await usersAPI.getByDepartment(2);
                showResult('usersResult', result);
            } catch (error) {
                showResult('usersResult', { error: error.message }, true);
            }
        }

        // ØªØ³Øª Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù†â€ŒÙ‡Ø§
        async function testGetDepartments() {
            try {
                const result = await departmentsAPI.getAll();
                showResult('departmentsResult', result);
            } catch (error) {
                showResult('departmentsResult', { error: error.message }, true);
            }
        }

        // ØªØ³Øª Ú©Ø§Ø±Ù‡Ø§
        async function testGetTasks() {
            try {
                const result = await tasksAPI.getAll();
                showResult('tasksResult', result);
            } catch (error) {
                showResult('tasksResult', { error: error.message }, true);
            }
        }

        async function testCreateTask() {
            try {
                const newTask = {
                    title: 'Ú©Ø§Ø± ØªØ³Øª',
                    description: 'Ø§ÛŒÙ† ÛŒÚ© Ú©Ø§Ø± ØªØ³ØªÛŒ Ø§Ø³Øª',
                    assigned_to: 2,
                    created_by: 1,
                    status: 'pending',
                    priority: 'medium',
                    due_date: '2025-11-15'
                };
                const result = await tasksAPI.create(newTask);
                showResult('tasksResult', result);
            } catch (error) {
                showResult('tasksResult', { error: error.message }, true);
            }
        }

        // ØªØ³Øª Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
        async function testGetDashboard() {
            try {
                const result = await reportsAPI.getDashboardStats();
                showResult('dashboardResult', result);
            } catch (error) {
                showResult('dashboardResult', { error: error.message }, true);
            }
        }

        // ØªØ³Øª LocalStorage
        function showLocalStorage() {
            const data = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('mock_')) {
                    data[key] = JSON.parse(localStorage.getItem(key));
                }
            }
            showResult('storageResult', data);
        }

        function clearLocalStorage() {
            const keys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('mock_')) {
                    keys.push(key);
                }
            }
            keys.forEach(key => localStorage.removeItem(key));
            
            // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯
            if (typeof mockDB !== 'undefined') {
                mockDB.seedData();
            }
            
            showResult('storageResult', { message: 'Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯' });
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', function() {
            checkApiStatus();
        });
    </script>
</body>
</html>