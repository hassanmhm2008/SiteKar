<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª ÙˆØ±ÙˆØ¯ Ø¨Ø§ Console Log</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            padding: 20px;
        }
        .log-box {
            background: #f4f4f4;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            direction: ltr;
            text-align: left;
        }
        .log-item {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }
        .log-error { color: red; }
        .log-success { color: green; }
        .log-info { color: blue; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ØªØ³Øª Ø¯ÛŒØ¨Ø§Ú¯ ÙˆØ±ÙˆØ¯</h1>
        
        <div class="form-group">
            <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</label>
            <input type="text" id="username" value="admin">
        </div>
        
        <div class="form-group">
            <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±:</label>
            <input type="password" id="password" value="admin123">
        </div>
        
        <button onclick="testLogin()" class="btn btn-primary">ØªØ³Øª ÙˆØ±ÙˆØ¯</button>
        <button onclick="testAPI()" class="btn">ØªØ³Øª Ø§ØªØµØ§Ù„ API</button>
        <button onclick="clearLogs()" class="btn">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§</button>
        
        <h3>ğŸ“‹ Ù„Ø§Ú¯â€ŒÙ‡Ø§:</h3>
        <div id="logBox" class="log-box"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        
        function addLog(message, type = 'info') {
            const logBox = document.getElementById('logBox');
            const logItem = document.createElement('div');
            logItem.className = 'log-item log-' + type;
            logItem.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            logBox.appendChild(logItem);
            logBox.scrollTop = logBox.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('logBox').innerHTML = '';
        }
        
        async function testAPI() {
            addLog('Ø´Ø±ÙˆØ¹ ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ API...', 'info');
            
            try {
                addLog('Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡: ' + API_BASE_URL + '/health', 'info');
                
                const response = await fetch(API_BASE_URL + '/health');
                
                addLog('ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§Ø³Ø®: ' + response.status, 'info');
                
                const data = await response.json();
                
                addLog('Ù¾Ø§Ø³Ø® Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯: ' + JSON.stringify(data), 'success');
                
                if (data.status === 'OK') {
                    addLog('âœ… Ø§ØªØµØ§Ù„ Ø¨Ù‡ API Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯!', 'success');
                }
            } catch (error) {
                addLog('âŒ Ø®Ø·Ø§: ' + error.message, 'error');
                addLog('Ù†ÙˆØ¹ Ø®Ø·Ø§: ' + error.name, 'error');
                addLog('Stack: ' + error.stack, 'error');
            }
        }
        
        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            addLog('==== Ø´Ø±ÙˆØ¹ ØªØ³Øª ÙˆØ±ÙˆØ¯ ====', 'info');
            addLog('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: ' + username, 'info');
            addLog('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±: ' + password, 'info');
            
            try {
                const url = API_BASE_URL + '/auth/login';
                addLog('URL: ' + url, 'info');
                
                const requestData = { username, password };
                addLog('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ: ' + JSON.stringify(requestData), 'info');
                
                addLog('Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª...', 'info');
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                addLog('ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§Ø³Ø®: ' + response.status + ' ' + response.statusText, 'info');
                addLog('Ù‡Ø¯Ø±Ù‡Ø§ÛŒ Ù¾Ø§Ø³Ø®: ' + JSON.stringify([...response.headers]), 'info');
                
                const data = await response.json();
                addLog('Ù¾Ø§Ø³Ø® JSON: ' + JSON.stringify(data, null, 2), 'info');
                
                if (data.success) {
                    addLog('âœ… ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯!', 'success');
                    addLog('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±: ' + JSON.stringify(data.user), 'success');
                    
                    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
                    localStorage.setItem('currentUser', JSON.stringify(data.user));
                    addLog('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
                    
                    addLog('Ø¢Ù…Ø§Ø¯Ù‡ Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ dashboard...', 'success');
                } else {
                    addLog('âŒ ÙˆØ±ÙˆØ¯ Ù†Ø§Ù…ÙˆÙÙ‚: ' + data.message, 'error');
                }
            } catch (error) {
                addLog('âŒ Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡!', 'error');
                addLog('Ù¾ÛŒØ§Ù… Ø®Ø·Ø§: ' + error.message, 'error');
                addLog('Ù†ÙˆØ¹ Ø®Ø·Ø§: ' + error.name, 'error');
                addLog('Stack trace: ' + error.stack, 'error');
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ Ø®Ø·Ø§
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    addLog('âš ï¸ Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ Ø³Ø±ÙˆØ± Backend Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ù†ÛŒØ³Øª!', 'error');
                } else if (error.name === 'SyntaxError') {
                    addLog('âš ï¸ Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ± JSON Ù…Ø¹ØªØ¨Ø±ÛŒ Ù†ÛŒØ³Øª!', 'error');
                }
            }
            
            addLog('==== Ù¾Ø§ÛŒØ§Ù† ØªØ³Øª ÙˆØ±ÙˆØ¯ ====', 'info');
        }
        
        // ØªØ³Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
        window.addEventListener('load', () => {
            addLog('ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', 'info');
            addLog('Ù…Ø±ÙˆØ±Ú¯Ø±: ' + navigator.userAgent, 'info');
            testAPI();
        });
    </script>
</body>
</html>
